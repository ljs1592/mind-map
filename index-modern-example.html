<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1">
  <link rel="icon" href="dist/logo.ico">
  <title>思绪思维导图 - Modern 主题 + 任务勾选</title>
  <script>
    // 自定义静态资源的路径
    window.externalPublicPath = './dist/'
    // 接管应用 - 设置为 true 以使用自定义数据和配置
    window.takeOverApp = true
  </script>
  <link href="dist/css/chunk-vendors.css" rel="stylesheet">
  <link href="dist/css/app.css" rel="stylesheet">
</head>
<body>
  <noscript>
    <strong>We're sorry but thoughts doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
  </noscript>
  <div id="app"></div>
  
  <script>
    // 从后端获取数据的函数（这里使用示例数据）
    const getDataFromBackend = () => {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          resolve({
            // 思维导图数据
            mindMapData: {
              root: {
                data: {
                  text: '📋 项目开发计划',
                  taskChecked: false
                },
                children: [
                  {
                    data: {
                      text: '需求分析阶段',
                      taskChecked: false
                    },
                    children: [
                      {
                        data: {
                          text: '收集用户需求',
                          taskChecked: true
                        },
                        children: []
                      },
                      {
                        data: {
                          text: '编写需求文档',
                          taskChecked: true
                        },
                        children: []
                      },
                      {
                        data: {
                          text: '需求评审会议',
                          taskChecked: false
                        },
                        children: []
                      }
                    ]
                  },
                  {
                    data: {
                      text: '设计阶段',
                      taskChecked: false
                    },
                    children: [
                      {
                        data: {
                          text: 'UI/UX 设计',
                          taskChecked: true
                        },
                        children: []
                      },
                      {
                        data: {
                          text: '数据库设计',
                          taskChecked: true
                        },
                        children: []
                      },
                      {
                        data: {
                          text: 'API 接口设计',
                          taskChecked: false
                        },
                        children: []
                      }
                    ]
                  },
                  {
                    data: {
                      text: '开发阶段',
                      taskChecked: false
                    },
                    children: [
                      {
                        data: {
                          text: '前端开发',
                          taskChecked: false
                        },
                        children: [
                          {
                            data: {
                              text: '页面组件开发',
                              taskChecked: false
                            },
                            children: []
                          },
                          {
                            data: {
                              text: '状态管理实现',
                              taskChecked: false
                            },
                            children: []
                          }
                        ]
                      },
                      {
                        data: {
                          text: '后端开发',
                          taskChecked: false
                        },
                        children: [
                          {
                            data: {
                              text: 'API 接口实现',
                              taskChecked: false
                            },
                            children: []
                          },
                          {
                            data: {
                              text: '数据库实现',
                              taskChecked: false
                            },
                            children: []
                          }
                        ]
                      }
                    ]
                  },
                  {
                    data: {
                      text: '测试阶段',
                      taskChecked: false
                    },
                    children: [
                      {
                        data: {
                          text: '单元测试',
                          taskChecked: false
                        },
                        children: []
                      },
                      {
                        data: {
                          text: '集成测试',
                          taskChecked: false
                        },
                        children: []
                      }
                    ]
                  }
                ]
              },
              theme: {
                template: 'modern',  // 使用 modern 主题
                config: {}
              },
              layout: 'logicalStructure',
              config: {},
              view: null
            },
            // 思维导图配置
            mindMapConfig: {
              // 添加勾选框到节点前置内容
              createNodePrefixContent: function(node) {
                if (window.mindMapInstance && window.mindMapInstance.taskCheckbox) {
                  return window.mindMapInstance.taskCheckbox.createCheckboxContent(node)
                }
                return null
              }
            },
            lang: 'zh',
            localConfig: null
          })
        }, 200)
      })
    }

    // 设置接管应用的方法
    const setTakeOverAppMethods = data => {
      window.takeOverAppMethods = {}
      
      // 获取思维导图数据的函数
      window.takeOverAppMethods.getMindMapData = () => {
        return data.mindMapData
      }
      
      // 保存思维导图数据的函数
      window.takeOverAppMethods.saveMindMapData = data => {
        console.log('保存思维导图数据:', data)
        // 这里可以添加保存到后端的逻辑
      }
      
      // 获取思维导图配置
      window.takeOverAppMethods.getMindMapConfig = () => {
        return data.mindMapConfig
      }
      
      // 保存思维导图配置
      window.takeOverAppMethods.saveMindMapConfig = config => {
        console.log('保存思维导图配置:', config)
      }
      
      // 获取语言的函数
      window.takeOverAppMethods.getLanguage = () => {
        return data.lang
      }
      
      // 保存语言的函数
      window.takeOverAppMethods.saveLanguage = lang => {
        console.log('保存语言:', lang)
      }
      
      // 获取本地配置的函数
      window.takeOverAppMethods.getLocalConfig = () => {
        return data.localConfig
      }
      
      // 保存本地配置的函数
      window.takeOverAppMethods.saveLocalConfig = config => {
        console.log('保存本地配置:', config)
      }
    }

    // 页面加载完成后初始化
    window.onload = async () => {
      if (!window.takeOverApp) return
      
      // 请求数据
      const data = await getDataFromBackend()
      
      // 设置全局的方法
      setTakeOverAppMethods(data)
      
      // 思维导图实例创建完成事件
      window.$bus.$on('app_inited', mindMap => {
        console.log('思维导图实例创建完成:', mindMap)
        // 将实例保存到全局，以便 createNodePrefixContent 可以访问
        window.mindMapInstance = mindMap
        
        // 监听节点点击事件
        mindMap.on('node_click', (node) => {
          console.log('节点点击:', node.nodeData.data)
        })
        
        // 监听数据变化
        mindMap.on('data_change', (data) => {
          console.log('数据变化')
        })
      })
      
      // 实例化页面
      window.initApp()
    }
  </script>
  
  <script src="dist/js/chunk-vendors.js"></script>
  <script src="dist/js/app.js"></script>
</body>
</html>

